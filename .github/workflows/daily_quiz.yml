name: Generate Notion Quiz ğŸ¤–

on:
  # å…è®¸ä½ åœ¨ç½‘é¡µä¸Šç‚¹å‡»æŒ‰é’®æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
  
  # (å¯é€‰) å¦‚æœä½ æƒ³æ¯å¤©æ—©ä¸Š 8 ç‚¹è‡ªåŠ¨è·‘ï¼ŒæŠŠä¸‹é¢ä¸¤è¡Œçš„ # å»æ‰
  schedule:
    - cron: "*/5 * * * *"

concurrency:
  group: notion-quiz
  cancel-in-progress: true

jobs:
  run-quiz:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout code (ä¸‹è½½ä»£ç )
        uses: actions/checkout@v3

      - name: ğŸŸ¢ Setup Node.js (å®‰è£…ç¯å¢ƒ)
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: ğŸ“¦ Install dependencies (å®‰è£…ä¾èµ–)
        # å¦‚æœä½ æœ‰ package.jsonï¼Œå®ƒä¼šå®‰è£…ï¼›å¦‚æœæ²¡æœ‰ï¼Œæ‰‹åŠ¨å®‰è£… node-fetch ä»¥é˜²ä¸‡ä¸€
        run: |
          if [ -f package.json ]; then
            npm install
          else
            npm install node-fetch
          fi

      - name: ğŸš€ Run Quiz Script (è¿è¡Œè„šæœ¬)
        # è¿™é‡ŒæŠŠæˆ‘ä»¬åœ¨ GitHub ç½‘é¡µè®¾ç½®çš„å¯†ç ä¼ ç»™è„šæœ¬
        env:
          NOTION_DB_ID: ${{ secrets.NOTION_DB_ID }}
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: node quiz/scripts/runQuiz.js